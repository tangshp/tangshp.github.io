<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>shell编程 | 唐成</title><meta name="keywords" content="Linux"><meta name="author" content="唐成"><meta name="copyright" content="唐成"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="sed,grep,awk">
<meta property="og:type" content="article">
<meta property="og:title" content="shell编程">
<meta property="og:url" content="http://example.com/2021/11/21/shell%E7%BC%96%E7%A8%8B/index.html">
<meta property="og:site_name" content="唐成">
<meta property="og:description" content="sed,grep,awk">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/images/linux.jpg">
<meta property="article:published_time" content="2021-11-21T11:54:38.000Z">
<meta property="article:modified_time" content="2021-12-12T15:23:12.353Z">
<meta property="article:author" content="唐成">
<meta property="article:tag" content="Linux">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/images/linux.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2021/11/21/shell%E7%BC%96%E7%A8%8B/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"prismjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'shell编程',
  isPost: true,
  isHome: false,
  isHighlightShrink: true,
  isToc: true,
  postUpdate: '2021-12-12 23:23:12'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if (GLOBAL_CONFIG_SITE.isHome && /iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    document.addEventListener('pjax:complete', detectApple)})(window)</script><meta name="generator" content="Hexo 5.4.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data is-center"><div class="data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">68</div></a></div><div class="data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">26</div></a></div><div class="data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">18</div></a></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/book/"><i class="fa-fw book"></i><span> 书籍</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 链接</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/images/linux.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">唐成</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/book/"><i class="fa-fw book"></i><span> 书籍</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 链接</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">shell编程</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-11-21T11:54:38.000Z" title="发表于 2021-11-21 19:54:38">2021-11-21</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2021-12-12T15:23:12.353Z" title="更新于 2021-12-12 23:23:12">2021-12-12</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Linux%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/">Linux的基本使用</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">5.2k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>25分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="shell编程"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="debug"><a href="#debug" class="headerlink" title="debug"></a>debug</h1><ul>
<li>以<code>debug</code>模式运行脚本</li>
</ul>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token comment"># 0-debug.sh</span>
<span class="token builtin class-name">echo</span> <span class="token string">"debug"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sh</span> -x ./0-debug.sh
+ <span class="token builtin class-name">echo</span> debug
debug<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>1.带<code>+</code>表示执行过程<br>2.没有<code>+</code>表示标准输出</p>
</blockquote>
<ul>
<li>在脚本中指定一部分脚本开启<code>debug</code></li>
</ul>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token builtin class-name">echo</span> <span class="token string">"debug"</span>
<span class="token builtin class-name">set</span> -x 
<span class="token function">ls</span>
<span class="token builtin class-name">set</span> +x
<span class="token builtin class-name">echo</span> <span class="token string">"end"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>1.<code>set -x</code>开启<code>debug</code><br>2.<code>set +x</code>关闭<code>debug</code></p>
</blockquote>
<h1 id="正则"><a href="#正则" class="headerlink" title="正则"></a>正则</h1><h2 id="正则符号"><a href="#正则符号" class="headerlink" title="正则符号"></a>正则符号</h2><ul>
<li>基础正则( <code>^</code> <code>$</code> <code>^$</code> <code>.</code> <code>*</code> <code>.*</code> <code>[a-z]</code> <code>[^abc]</code> )-(<code>Basic RE-BRE</code>)<br>支持的命令包括<code>grep/sed/awk</code></li>
<li>扩展正则( <code>+</code> <code>|</code> <code>()</code> <code>&#123;&#125;</code> <code>?</code>)-(<code>Extended RE-ERE</code>)<br>支持的命令包括<code>egrep/sed -r/awk</code></li>
</ul>
<h2 id="正则VS通配符"><a href="#正则VS通配符" class="headerlink" title="正则VS通配符"></a>正则<code>VS</code>通配符</h2><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">分类</th>
<th style="text-align:center">用途</th>
<th style="text-align:center">支持的命令</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">正则(<code>re</code>)</td>
<td style="text-align:center">三剑客,高级语言;被用作过滤(匹配字符)</td>
<td style="text-align:center">三剑客<code>grep,sed,awk,find,rename,expr</code></td>
</tr>
<tr>
<td style="text-align:center">通配符(<code>pathname extension</code> 或则<code>glob</code>)</td>
<td style="text-align:center">匹配文件名(<code>*.txt, *.log</code>)</td>
<td style="text-align:center"><code>Linux</code>中大部分命令</td>
</tr>
</tbody>
</table>
</div>
<h2 id="基础正则"><a href="#基础正则" class="headerlink" title="基础正则"></a>基础正则</h2><p><strong>素材</strong><br><code>grep_help.txt</code><br><pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">grep  searches for PATTERNS in each FILE.  PATTERNS is one or more patterns 
separated by newline characters, and grep prints each line that matches a pattern.
Typically PATTERNS should be quoted when grep is used in a shell command.

A FILE of “-” stands for standard input.  If no FILE is given, recursive searches 
examine the working  directory,  and  nonrecursive  searches  read  standard
input.

In  addition, the variant programs egrep, fgrep and rgrep are the same as grep -E, 
grep -F, and grep -r, respectively.  These variants are deprecated, but are
provided for backward compatibility.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p>
<ul>
<li><code>^xxx</code>-以<code>xxx</code>开头的行<br>搜索以<code>In</code>开头的行<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">➜  Scripts <span class="token function">grep</span> <span class="token string">"^In"</span> ./grep_help.txt <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<img src="/images/shell/^xxx.png" alt="结果"></li>
</ul>
<ul>
<li><p><code>xxx$</code>-以<code>xxx</code>结尾的行<br>搜索以<code>.</code>结尾的行</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">➜  Scripts <span class="token function">grep</span> <span class="token string">'\.$'</span> ./grep_help.txt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="/images/shell/xxx$.png" alt="结果"></p>
</li>
<li><p><code>^$</code>-<strong>空行</strong><br><strong>空行</strong>表示没有任何字符(空格也没有)</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">➜  Scripts <span class="token function">grep</span> -n <span class="token string">'^$'</span> ./grep_help.txt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><strong>用法</strong>:排除空行</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">grep</span> -v <span class="token string">'^$'</span> ./grep_help.txt
<span class="token function">grep</span>  searches <span class="token keyword">for</span> <span class="token for-or-select variable">PATTERNS</span> <span class="token keyword">in</span> each FILE.  PATTERNS is one or <span class="token function">more</span> patterns 
separated by newline characters, and <span class="token function">grep</span> prints each line that matches a pattern.
Typically PATTERNS should be quoted when <span class="token function">grep</span> is used <span class="token keyword">in</span> a shell command.
A FILE of “-” stands <span class="token keyword">for</span> standard input.  If no FILE is given, recursive searches 
examine the working  directory,  and  nonrecursive  searches  <span class="token builtin class-name">read</span>  standard
input.
In  addition, the variant programs egrep, <span class="token function">fgrep</span> and rgrep are the same as <span class="token function">grep</span> -E, 
<span class="token function">grep</span> -F, and <span class="token function">grep</span> -r, respectively.  These variants are deprecated, but are
provided <span class="token keyword">for</span> backward compatibility.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p><code>.</code>-<strong>任意一个字符</strong><br><strong>但是会忽略空行</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">➜  Scripts <span class="token function">grep</span> <span class="token string">'. '</span> ./grep_help.txt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="/images/shell/any.png" alt="结果"></p>
</li>
<li><p><code>x*</code>-<code>0</code>次及<code>0</code>次以上出现<code>x</code></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">➜  Scripts <span class="token function">grep</span> <span class="token string">'T*'</span> ./grep_help.txt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="/images/shell/xany.png" alt="结果"></p>
</li>
<li><p><code>.*</code>-<strong>所有</strong><br><strong>运用</strong>:匹配以指定字符结束的行</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">➜  Scripts <span class="token function">grep</span> <span class="token string">'^.*P'</span> ./grep_help.txt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="/images/shell/compose.png" alt="结果"></p>
<blockquote>
<p>到最后一个指定字符, 则体现了正则表达式的<strong>贪婪行</strong></p>
</blockquote>
</li>
<li><p><code>[abc]</code>-一次匹配一个字符(<code>a,b,c</code>中任意一个)</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">➜  Scripts <span class="token function">grep</span> <span class="token string">'[a-z]'</span> ./grep_help.txt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="/images/shell/az.png" alt="结果"></p>
<ul>
<li><p>匹配大小写与数字</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">➜  Scripts <span class="token function">grep</span> <span class="token string">'[a-zA-Z0-9]'</span> ./grep_help.txt
➜  Scripts <span class="token function">grep</span> <span class="token string">'[a-Z0-9]'</span> ./grep_help.txt <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><img src="/images/shell/aZ09.png" alt="结果"></p>
</li>
<li><p><code>[]</code>中添加其它的符号<br>除了匹配<code>a-Z 0-9</code>以外,还要匹配<code>,</code>和<code>.</code></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">➜  Scripts <span class="token function">grep</span> <span class="token string">'[a-Z,.0-9]'</span> ./grep_help.txt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="/images/shell/fromaZ.png" alt="结果"></p>
</li>
</ul>
</li>
<li><p><code>[^xxx]</code>-匹配除<code>xxx</code>以外的内容</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">➜  Scripts <span class="token function">grep</span> <span class="token string">'[^a-z]'</span> ./grep_help.txt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="/images/shell/other.png" alt="结果"></p>
</li>
</ul>
<h2 id="扩展正则"><a href="#扩展正则" class="headerlink" title="扩展正则"></a>扩展正则</h2><ul>
<li><p><code>+</code>-匹配<code>1</code>或则<code>1</code>个以上的字符,并输出匹配到的行<br>要使用扩展正则命令,需要以以下三种方式书写</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">grep</span> <span class="token string">'m\+'</span> ./grep_help.txt
<span class="token function">grep</span> -E <span class="token string">'m+'</span> ./grep_help.txt
<span class="token function">egrep</span> <span class="token string">'m+'</span> ./grep_help.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><img src="/images/shell/+ERE.png" alt="结果"></p>
<ul>
<li>匹配文件中连续的数字<br>素材<code>ascii.txt</code><pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">000   0     00    NUL '\0' (null character)   100   64    40    @
001   1     01    SOH (start of heading)      101   65    41    A<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">egrep</span> -o <span class="token string">'[0-9]+'</span> ./ascii.txt
<span class="token function">egrep</span> <span class="token string">'[0-9]+'</span> ./ascii.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<img src="/images/shell/+RER_0.png" alt="结果"><blockquote>
<p><code>-o</code>表示输出过程,可获得匹配到的对象,而不是整行</p>
</blockquote>
</li>
</ul>
</li>
<li><p><code>|</code>-或者</p>
</li>
</ul>
<p>匹配单词或则数值<br><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">egrep</span> <span class="token string">'[0-9]+|[a-Z]+'</span> ./ascii.txt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><br><img src="/images/shell/or_ERE.png" alt="结果"></p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">符号</th>
<th style="text-align:center">区别</th>
<th style="text-align:center">运用场景</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><code>[]</code></td>
<td style="text-align:center"><code>1</code>一次匹配一个字符<code>[abc]</code></td>
<td style="text-align:center">匹配单个字符</td>
</tr>
<tr>
<td style="text-align:center">&#124;</td>
<td style="text-align:center">a &#124; b &#124; c &#124; string</td>
<td style="text-align:center">匹配单词</td>
</tr>
</tbody>
</table>
</div>
<ul>
<li><p><code>()</code>-括号</p>
<blockquote>
<p>1.被括号括起来的内容是一个整体<br>2.反向引用-<code>sed</code></p>
</blockquote>
<ul>
<li>匹配<code>tooth或者teeth</code><br>素材<code>bracket.txt</code><pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">if a law or an organization has teeth, it has the power to force people to obey it.
We fought tooth and nail to get these plans accepted.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">egrep</span> <span class="token string">'t(oo|ee)th'</span> ./bracket.txt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<img src="/images/shell/bracket_0.png" alt="结果"></li>
</ul>
</li>
</ul>
<ul>
<li><code>&#123;&#125;</code>-连续出现<br>使用格式为,其中$k$表示出现的次数</li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">格式</th>
<th style="text-align:center">说明</th>
<th style="text-align:center">备注</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><code>x&#123;n,m&#125;</code></td>
<td style="text-align:center">表示前一个字母<code>x</code>至少连续出现<code>n</code>次,之多出现<code>m</code>次</td>
<td style="text-align:center">$ n \le k \le m$</td>
</tr>
<tr>
<td style="text-align:center"><code>x&#123;n&#125;</code></td>
<td style="text-align:center">表示前一个字母<code>x</code>恰好连续出现<code>n</code>次</td>
<td style="text-align:center">$ k = n $</td>
</tr>
<tr>
<td style="text-align:center"><code>x&#123;,m&#125;</code></td>
<td style="text-align:center">表示前一个字母<code>x</code>恰好连续出现<code>n</code>次</td>
<td style="text-align:center">$ k \le m $</td>
</tr>
<tr>
<td style="text-align:center"><code>x&#123;n,&#125;</code></td>
<td style="text-align:center">表示前一个字母<code>x</code>恰好连续出现<code>n</code>次</td>
<td style="text-align:center">$ k \ge n$</td>
</tr>
</tbody>
</table>
</div>
<ul>
<li><p><code>?</code>-前一个字符出现<code>0</code>次或者<code>1</code>次</p>
<blockquote>
<p>匹配符合要求的行</p>
</blockquote>
<ul>
<li><p>匹配单复数<br><code>question_mark.txt</code></p>
<pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">Peel the oranges and divide them into segments.
a bright shade of orange<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><img src="/images/shell/question_mark.png" alt="结果"></p>
</li>
</ul>
</li>
</ul>
<h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><h3 id="粗略地匹配身份证"><a href="#粗略地匹配身份证" class="headerlink" title="粗略地匹配身份证"></a>粗略地匹配身份证</h3><pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">赵 211324198705244720
钱 500224197105168312
孙 1233211234569sunSS
李 liliangcheng
周 zhou21132693130593
吴 14052219961008852X
郑 431009199606233566
王 47001320060315X365<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="/images/shell/id.png" alt="结果"></p>
<h3 id="排除空行和包含-的行"><a href="#排除空行和包含-的行" class="headerlink" title="排除空行和包含^的行"></a>排除空行和包含<code>^</code>的行</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">egrep</span> -v <span class="token string">'^$|#'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h1 id="三剑客"><a href="#三剑客" class="headerlink" title="三剑客"></a>三剑客</h1><div class="table-container">
<table>
<thead>
<tr>
<th>命令</th>
<th>特点</th>
<th>场景</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>grep</code></td>
<td>过滤</td>
<td><code>grep</code>命令过滤速度最快</td>
</tr>
<tr>
<td><code>sed</code></td>
<td>替换,修改文件内容,取行</td>
<td>如果要进行替换/修改文件内容,取出某个范围的内容(从早上10:00到11:00)</td>
</tr>
<tr>
<td><code>awk</code></td>
<td>取列,统计计算</td>
<td>取列,对比/比较(<code>&gt;=, &lt;=,!=</code>),统计,计算(<code>awk数组</code>)</td>
</tr>
</tbody>
</table>
</div>
<h2 id="三剑客-grep"><a href="#三剑客-grep" class="headerlink" title="三剑客-grep"></a>三剑客-grep</h2><p><code>Global Regular Expression Print</code></p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">选项</th>
<th style="text-align:center">含义</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><code>-E</code></td>
<td style="text-align:center">等同于<code>egrep</code></td>
</tr>
<tr>
<td style="text-align:center"><code>-A</code></td>
<td style="text-align:center"><code>-A5</code>匹配的内容往后<code>5</code>行(<code>after</code>)</td>
</tr>
<tr>
<td style="text-align:center"><code>-B</code></td>
<td style="text-align:center"><code>-B5</code>匹配的内容之前<code>5</code>行(<code>before</code>)</td>
</tr>
<tr>
<td style="text-align:center"><code>-C</code></td>
<td style="text-align:center"><code>-C5</code>匹配的内容前后共<code>5</code>行(<code>context</code>)</td>
</tr>
<tr>
<td style="text-align:center"><code>-c</code>小写</td>
<td style="text-align:center">统计出现了多少行,等同于<code>wc -l</code></td>
</tr>
<tr>
<td style="text-align:center"><code>-v</code>小写</td>
<td style="text-align:center">取反(排除行)</td>
</tr>
<tr>
<td style="text-align:center"><code>-n</code>小写</td>
<td style="text-align:center">显示行号</td>
</tr>
<tr>
<td style="text-align:center"><code>-i</code>小写</td>
<td style="text-align:center">忽略大小写</td>
</tr>
<tr>
<td style="text-align:center"><code>-w</code>小写</td>
<td style="text-align:center">精确匹配</td>
</tr>
</tbody>
</table>
</div>
<ul>
<li><p><code>-C</code></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">➜  Scripts <span class="token function">seq</span> <span class="token number">10</span> <span class="token operator">|</span> <span class="token function">grep</span> -C1 <span class="token number">5</span>
<span class="token number">4</span>
<span class="token number">5</span>
<span class="token number">6</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p><code>-c</code></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">➜  Scripts <span class="token function">ps</span> -ef <span class="token operator">|</span> <span class="token function">grep</span> sshd <span class="token operator">|</span> <span class="token function">wc</span> -l
<span class="token number">8</span>
➜  Scripts <span class="token function">ps</span> -ef <span class="token operator">|</span> <span class="token function">grep</span> -c sshd     
<span class="token number">8</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p><code>-v</code></p>
<blockquote>
<p>过滤<code>grep</code>本身这个进程</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">➜  Scripts <span class="token function">ps</span> -ef <span class="token operator">|</span> <span class="token function">grep</span> hexo         
tangshp     <span class="token number">6109</span>    <span class="token number">5504</span>  <span class="token number">1</span> <span class="token number">20</span>:42 pts/0    00:01:56 hexo
tangshp     <span class="token number">8281</span>    <span class="token number">6205</span>  <span class="token number">0</span> <span class="token number">22</span>:24 pts/1    00:00:00 <span class="token function">grep</span> --color<span class="token operator">=</span>auto hexo
➜  Scripts <span class="token function">ps</span> -ef <span class="token operator">|</span> <span class="token function">grep</span> hexo <span class="token operator">|</span> <span class="token function">grep</span> -v auto
tangshp     <span class="token number">6109</span>    <span class="token number">5504</span>  <span class="token number">1</span> <span class="token number">20</span>:42 pts/0    00:01:56 hexo<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</blockquote>
</li>
<li><p><code>w</code></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">➜  Scripts <span class="token builtin class-name">echo</span> hello helloworld <span class="token operator">|</span> <span class="token function">grep</span> -w hello
hello helloworld<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><img src="/images/shell/grepw.png" alt="结果"></p>
<blockquote>
<p><code>\b</code>表示边界</p>
</blockquote>
</li>
</ul>
<h2 id="三剑客-sed"><a href="#三剑客-sed" class="headerlink" title="三剑客-sed"></a>三剑客-sed</h2><p><code>stream editor</code>流编辑器</p>
<h3 id="sed格式"><a href="#sed格式" class="headerlink" title="sed格式"></a><code>sed</code>格式</h3><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">命令</th>
<th style="text-align:center">选项</th>
<th style="text-align:center">sed命令功能</th>
<th style="text-align:center">参数/文件</th>
<th style="text-align:center">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><code>sed</code></td>
<td style="text-align:center"><code>-r</code></td>
<td style="text-align:center"><code>s#orange#apple#g</code></td>
<td style="text-align:center"><code>question_mark.txt</code></td>
<td style="text-align:center"><code>s</code>替换,<code>g</code>修饰符</td>
</tr>
</tbody>
</table>
</div>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">➜  Scripts <span class="token function">sed</span> -r <span class="token string">'s#orange#apple#g'</span> ./question_mark.txt 
Peel the apples and divide them into segments.
a bright shade of apple%     <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>把<code>orange</code>替换为<code>apple</code></p>
</blockquote>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">功能</th>
<th style="text-align:center"></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><code>s</code></td>
<td style="text-align:center">替换<code>substitute</code></td>
</tr>
<tr>
<td style="text-align:center"><code>p</code></td>
<td style="text-align:center">显示<code>print</code></td>
</tr>
<tr>
<td style="text-align:center"><code>d</code></td>
<td style="text-align:center">删除<code>delete</code></td>
</tr>
<tr>
<td style="text-align:center"><code>cai</code></td>
<td style="text-align:center">增加<code>c/a/i</code></td>
</tr>
</tbody>
</table>
</div>
<h3 id="sed查找"><a href="#sed查找" class="headerlink" title="sed查找"></a><code>sed</code>查找</h3><ul>
<li><p>流程<br><img src="/images/sed_process.png" alt="结果"></p>
</li>
<li><p><code>sed</code>查找格式</p>
</li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">查找格式</th>
<th style="text-align:center">说明</th>
<th style="text-align:center">示例</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><code>xp</code></td>
<td style="text-align:center">查找第<code>x</code>行</td>
<td style="text-align:center"><code>demo0</code></td>
</tr>
<tr>
<td style="text-align:center"><code>m,np</code></td>
<td style="text-align:center">查找第<code>n</code>行到第<code>m</code>行</td>
<td style="text-align:center"><code>demo1</code></td>
</tr>
<tr>
<td style="text-align:center"><code>/regular/p</code></td>
<td style="text-align:center">查找符合<code>regular</code>的行,<code>//</code>里面可以写正则表达式</td>
<td style="text-align:center"><code>demo2</code></td>
</tr>
<tr>
<td style="text-align:center"><code>/10:00/,/11:00/p</code></td>
<td style="text-align:center">表示范围过滤</td>
<td style="text-align:center"><code>demo3</code></td>
</tr>
</tbody>
</table>
</div>
<p><code>sed_test.txt</code><br><pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">10:00 赵 211324198705244720
10:10 钱 500224197105168312
10:20 孙 1233211234569sunSS
10:30 李 liliangcheng
10:40 周 zhou21132693130593
10:50 吴 14052219961008852X
10:60 郑 431009199606233566
10:70 王 47001320060315X365<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p>
<ul>
<li><strong>查找示例</strong></li>
</ul>
<ul>
<li><p><code>demo0</code></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">➜  Scripts <span class="token function">sed</span> -n <span class="token string">'3p'</span> ./sed_test.txt 
<span class="token number">10</span>:20 孙 1233211234569sunSS<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p><code>demo1</code></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">➜  Scripts <span class="token function">sed</span> -n <span class="token string">'2,4p'</span> ./sed_test.txt
<span class="token number">10</span>:10 钱 <span class="token number">500224197105168312</span>
<span class="token number">10</span>:20 孙 1233211234569sunSS
<span class="token number">10</span>:30 李 liliangcheng
➜  Scripts <span class="token function">sed</span> -n <span class="token string">'7,$p'</span> ./sed_test.txt             
<span class="token number">10</span>:60 郑 <span class="token number">431009199606233566</span>
<span class="token number">10</span>:70 王 47001320060315X365<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p><code>demo2</code></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">➜  Scripts <span class="token function">sed</span> -nr <span class="token string">'/[0-9]&#123;17&#125;[0-9X]/p'</span> ./sed_test.txt
<span class="token number">10</span>:00 赵 <span class="token number">211324198705244720</span>
<span class="token number">10</span>:10 钱 <span class="token number">500224197105168312</span>
<span class="token number">10</span>:50 吴 14052219961008852X
<span class="token number">10</span>:60 郑 <span class="token number">431009199606233566</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p><code>-r</code>表示使用扩展正则表达式</p>
</blockquote>
</li>
<li><p><code>demo3</code></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">➜  Scripts <span class="token function">sed</span> -n <span class="token string">'/10:30/,/10:50/p'</span> ./sed_test.txt 
<span class="token number">10</span>:30 李 liliangcheng
<span class="token number">10</span>:40 周 zhou21132693130593
<span class="token number">10</span>:50 吴 14052219961008852X<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
</li>
</ul>
<h3 id="删除-delete"><a href="#删除-delete" class="headerlink" title="删除-delete"></a>删除-<code>delete</code></h3><ul>
<li>删除格式</li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">查找格式</th>
<th style="text-align:center">说明</th>
<th style="text-align:center">示例</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><code>xd</code></td>
<td style="text-align:center">删除第<code>x</code>行</td>
<td style="text-align:center"><code>demo0</code></td>
</tr>
<tr>
<td style="text-align:center"><code>m,nd</code></td>
<td style="text-align:center">删除第<code>n</code>行到第<code>m</code>行</td>
<td style="text-align:center"><code>demo1</code></td>
</tr>
<tr>
<td style="text-align:center"><code>/regular/d</code></td>
<td style="text-align:center">查找符合<code>regular</code>的行,<code>//</code>里面可以写正则表达式</td>
<td style="text-align:center"><code>demo2</code></td>
</tr>
<tr>
<td style="text-align:center"><code>/10:00/,/11:00/d</code></td>
<td style="text-align:center">表示范围过滤</td>
<td style="text-align:center"><code>demo3</code></td>
</tr>
</tbody>
</table>
</div>
<ul>
<li><p><strong>删除示例</strong></p>
<ul>
<li><p>删除第<code>x</code>行</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">➜  Scripts <span class="token function">sed</span> <span class="token string">'1d'</span> ./sed_test.txt              
<span class="token number">10</span>:10 钱 <span class="token number">500224197105168312</span>
<span class="token number">10</span>:20 孙 1233211234569sunSS
<span class="token number">10</span>:30 李 liliangcheng
<span class="token number">10</span>:40 周 zhou21132693130593
<span class="token number">10</span>:50 吴 14052219961008852X
<span class="token number">10</span>:60 郑 <span class="token number">431009199606233566</span>
<span class="token number">10</span>:70 王 47001320060315X365%<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>删除第<code>n</code>行到第<code>m</code>行  </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">➜  Scripts <span class="token function">sed</span> <span class="token string">'5,8d'</span> ./sed_test.txt
<span class="token number">10</span>:00 赵 <span class="token number">211324198705244720</span>
<span class="token number">10</span>:10 钱 <span class="token number">500224197105168312</span>
<span class="token number">10</span>:20 孙 1233211234569sunSS
<span class="token number">10</span>:30 李 liliangcheng<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>查找符合<code>regular</code>的行</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">➜  Scripts <span class="token function">sed</span> -r <span class="token string">'/[0-9]&#123;17&#125;[0-9xX]/d'</span> ./sed_test.txt
<span class="token number">10</span>:20 孙 1233211234569sunSS
<span class="token number">10</span>:30 李 liliangcheng
<span class="token number">10</span>:40 周 zhou21132693130593
<span class="token number">10</span>:70 王 47001320060315X365% <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>表示范围过滤</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">➜  Scripts <span class="token function">sed</span> -r <span class="token string">'/10:20/,/10:50/d'</span> ./sed_test.txt
<span class="token number">10</span>:00 赵 <span class="token number">211324198705244720</span>
<span class="token number">10</span>:10 钱 <span class="token number">500224197105168312</span>
<span class="token number">10</span>:60 郑 <span class="token number">431009199606233566</span>
<span class="token number">10</span>:70 王 47001320060315X365%<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>删除空行或则带<code>#</code>号的行<br><strong>方法一</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">➜  Scripts <span class="token function">sed</span> -r <span class="token string">'/^$|#/d'</span> /etc/ssh/sshd_config
Include /etc/ssh/sshd_config.d/*.conf
ChallengeResponseAuthentication no
UsePAM <span class="token function">yes</span>
X11Forwarding <span class="token function">yes</span>
PrintMotd no
AcceptEnv <span class="token environment constant">LANG</span> LC_*
Subsystem       <span class="token function">sftp</span>    /usr/lib/openssh/sftp-server<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>方法二</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">➜  Scripts <span class="token function">egrep</span> -v <span class="token string">'^$|#'</span> /etc/ssh/sshd_config
Include /etc/ssh/sshd_config.d/*.conf
ChallengeResponseAuthentication no
UsePAM <span class="token function">yes</span>
X11Forwarding <span class="token function">yes</span>
PrintMotd no
AcceptEnv <span class="token environment constant">LANG</span> LC_*
Subsystem       <span class="token function">sftp</span>    /usr/lib/openssh/sftp-server<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>!</code><strong>的妙用</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">➜  Scripts <span class="token function">sed</span> -rn <span class="token string">'/^$|#/!p'</span> /etc/ssh/sshd_config
Include /etc/ssh/sshd_config.d/*.conf
ChallengeResponseAuthentication no
UsePAM <span class="token function">yes</span>
X11Forwarding <span class="token function">yes</span>
PrintMotd no
AcceptEnv <span class="token environment constant">LANG</span> LC_*
Subsystem       <span class="token function">sftp</span>    /usr/lib/openssh/sftp-server<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p><code>-r</code>表示扩展,<code>-n</code>表示符合的才打印,<code>!</code>表示取反;</p>
</blockquote>
</li>
</ul>
</li>
</ul>
<h3 id="sed-增加cai"><a href="#sed-增加cai" class="headerlink" title="sed-增加cai"></a>sed-增加<code>cai</code></h3><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">参数</th>
<th style="text-align:center">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><code>c</code></td>
<td style="text-align:center"><code>replace</code>替代</td>
</tr>
<tr>
<td style="text-align:center"><code>a</code></td>
<td style="text-align:center"><code>append</code>追加</td>
</tr>
<tr>
<td style="text-align:center"><code>i</code></td>
<td style="text-align:center"><code>insert</code>插入</td>
</tr>
</tbody>
</table>
</div>
<blockquote>
<p><code>cai</code>同样可以使用以下表格的格式, 但是要把<code>d</code>改为<code>cai</code></p>
</blockquote>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">查找格式</th>
<th style="text-align:center">说明</th>
<th style="text-align:center">示例</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><code>xd</code></td>
<td style="text-align:center">删除第<code>x</code>行</td>
<td style="text-align:center"><code>demo0</code></td>
</tr>
<tr>
<td style="text-align:center"><code>m,nd</code></td>
<td style="text-align:center">删除第<code>n</code>行到第<code>m</code>行</td>
<td style="text-align:center"><code>demo1</code></td>
</tr>
<tr>
<td style="text-align:center"><code>/regular/d</code></td>
<td style="text-align:center">查找符合<code>regular</code>的行,<code>//</code>里面可以写正则表达式</td>
<td style="text-align:center"><code>demo2</code></td>
</tr>
<tr>
<td style="text-align:center"><code>/10:00/,/11:00/d</code></td>
<td style="text-align:center">表示范围过滤</td>
<td style="text-align:center"><code>demo3</code></td>
</tr>
</tbody>
</table>
</div>
<ul>
<li><p>示例</p>
<ul>
<li><p><code>append</code>追加,在第二行后添加</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">➜  Scripts <span class="token function">sed</span> <span class="token string">'2a 10:15 谭 63269199308363956x'</span> ./sed_test.txt
<span class="token number">10</span>:00 赵 <span class="token number">211324198705244720</span>
<span class="token number">10</span>:10 钱 <span class="token number">500224197105168312</span>
<span class="token number">10</span>:15 谭 63269199308363956x
<span class="token number">10</span>:20 孙 1233211234569sunSS
<span class="token number">10</span>:30 李 liliangcheng
<span class="token number">10</span>:40 周 zhou21132693130593
<span class="token number">10</span>:50 吴 14052219961008852X
<span class="token number">10</span>:60 郑 <span class="token number">431009199606233566</span>
<span class="token number">10</span>:70 王 47001320060315X365% <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p><code>2a</code>后面的空格可有可无</p>
</blockquote>
</li>
<li><p><code>insert</code>插入,在第二行前添加</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">➜  Scripts <span class="token function">sed</span> <span class="token string">'2i 10:15 谭 63269199308363956x'</span> ./sed_test.txt
<span class="token number">10</span>:00 赵 <span class="token number">211324198705244720</span>
<span class="token number">10</span>:15 谭 63269199308363956x
<span class="token number">10</span>:10 钱 <span class="token number">500224197105168312</span>
<span class="token number">10</span>:20 孙 1233211234569sunSS
<span class="token number">10</span>:30 李 liliangcheng
<span class="token number">10</span>:40 周 zhou21132693130593
<span class="token number">10</span>:50 吴 14052219961008852X
<span class="token number">10</span>:60 郑 <span class="token number">431009199606233566</span>
<span class="token number">10</span>:70 王 47001320060315X365%<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p><code>replace</code>替代,把第二行替换为指定内容</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">➜  Scripts <span class="token function">sed</span> <span class="token string">'2c 10:15 谭 63269199308363956x'</span> ./sed_test.txt
<span class="token number">10</span>:00 赵 <span class="token number">211324198705244720</span>
<span class="token number">10</span>:15 谭 63269199308363956x
<span class="token number">10</span>:20 孙 1233211234569sunSS
<span class="token number">10</span>:30 李 liliangcheng
<span class="token number">10</span>:40 周 zhou21132693130593
<span class="token number">10</span>:50 吴 14052219961008852X
<span class="token number">10</span>:60 郑 <span class="token number">431009199606233566</span>
<span class="token number">10</span>:70 王 47001320060315X365% <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>运用-在文件结尾添加<br><strong>方法</strong>-<code>cat</code></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">➜  Scripts <span class="token function">cat</span> <span class="token operator">>></span>ascii.txt<span class="token operator">&lt;&lt;</span><span class="token string">'EOF'</span>
heredoc<span class="token operator">></span> 
heredoc<span class="token operator">></span> ABCDEFGHIJKLMNOPKRSTUVWXYZ
heredoc<span class="token operator">></span> EOF <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">000   0     00    NUL '\0' (null character)   100   64    40    @
001   1     01    SOH (start of heading)      101   65    41    A
ABCDEFGHIJKLMNOPQRSNUVWXYZEOF<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><strong>方法</strong>-<code>sed</code></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">➜  Scripts <span class="token function">sed</span> <span class="token string">'$a ABCDEFGHIJKLMNOPKRSTUVWXYZ\nabcdefghijklmnopqrstuvwxyz'</span> ./ascii.txt
000   <span class="token number">0</span>     00    NUL <span class="token string">'\0'</span> <span class="token punctuation">(</span>null character<span class="token punctuation">)</span>   <span class="token number">100</span>   <span class="token number">64</span>    <span class="token number">40</span>    @
001   <span class="token number">1</span>     01    SOH <span class="token punctuation">(</span>start of heading<span class="token punctuation">)</span>      <span class="token number">101</span>   <span class="token number">65</span>    <span class="token number">41</span>    A
ABCDEFGHIJKLMNOPKRSTUVWXYZ
abcdefghijklmnopqrstuvwxyz<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
</ul>
</li>
</ul>
<h3 id="sed-替换s"><a href="#sed-替换s" class="headerlink" title="sed-替换s"></a>sed-替换s</h3><ul>
<li><p>demo1</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">➜  Scripts <span class="token function">sed</span> <span class="token string">'s# ##g'</span> ./ascii.txt                                                   
000000NUL<span class="token string">'\0'</span><span class="token punctuation">(</span>nullcharacter<span class="token punctuation">)</span><span class="token number">1006440</span>@
001101SOH<span class="token punctuation">(</span>startofheading<span class="token punctuation">)</span>1016541A% <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>把<code>空格替换为空</code>,第一个<code>#</code>和第二个<code>#</code>之间用于查找,第二个<code>#</code>和第三个<code>#</code>之间用于替换<br>‘-g’表示全局替换, 否则默认替换每行第一个匹配的对象</p>
</blockquote>
</li>
<li><p>demo2</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">➜  Scripts <span class="token function">sed</span> <span class="token string">'s#00#XX#g'</span> ./ascii.txt
XX0   <span class="token number">0</span>     XX    NUL <span class="token string">'\0'</span> <span class="token punctuation">(</span>null character<span class="token punctuation">)</span>   1XX   <span class="token number">64</span>    <span class="token number">40</span>    @
XX1   <span class="token number">1</span>     01    SOH <span class="token punctuation">(</span>start of heading<span class="token punctuation">)</span>      <span class="token number">101</span>   <span class="token number">65</span>    <span class="token number">41</span>    A%<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>后向引用</p>
<ul>
<li><p>把<code>123456</code>变成<code>&lt;123456&gt;</code></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">➜  Scripts <span class="token builtin class-name">echo</span> <span class="token number">123456</span> <span class="token operator">|</span> <span class="token function">sed</span> -r <span class="token string">'s#(.*)#&lt;\1>#g'</span>
<span class="token operator">&lt;</span><span class="token number">12345</span><span class="token operator"><span class="token file-descriptor important">6</span>></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<blockquote>
<p><code>()</code>表示把括号内的内容保护起来</p>
</blockquote>
</li>
<li><p>把<code>123456</code>变成<code>12&lt;34&gt;56</code><br>把<code>34</code>替换为<code>&lt;34&gt;</code></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">➜  Scripts <span class="token builtin class-name">echo</span> <span class="token number">123456</span> <span class="token operator">|</span> <span class="token function">sed</span> -r <span class="token string">'s#(34)#&lt;\1>#g'</span>
<span class="token number">1</span><span class="token operator"><span class="token file-descriptor important">2</span>&lt;</span><span class="token number">3</span><span class="token operator"><span class="token file-descriptor important">4</span>></span><span class="token number">56</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<blockquote>
<p><code>-r</code>表示使用扩展正则</p>
</blockquote>
</li>
<li><p>把表情<code>@_^</code>变成<code>^_@</code></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">➜  Scripts <span class="token builtin class-name">echo</span> @_^ <span class="token operator">|</span> <span class="token function">sed</span> -r <span class="token string">"s#(^.*)_(.*$)#<span class="token entity" title="\2">\2</span>_<span class="token entity" title="\1">\1</span>#g"</span>
^_@<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<blockquote>
<p><code>\1</code>和<code>\2</code>分别表示第一个括号和第二个括号</p>
</blockquote>
</li>
<li><p>获取<code>ip</code>地址</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">➜  Scripts <span class="token function">ip</span> a s eth0   
<span class="token number">2</span>: eth0: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="token operator">></span> mtu <span class="token number">1500</span> qdisc mq state UP group default qlen <span class="token number">1000</span>
link/ether dc:a6:32:f1:16:3e brd ff:fe:fe:af:ff:ff
inet <span class="token number">122.138</span>.3.43/24 brd <span class="token number">152.148</span>.4.255 scope global dynamic noprefixroute eth0
   valid_lft 84618sec preferred_lft 84618sec
inet6 <span class="token number">2408</span>:8352:440:30b1:d734:3ba9:b69f:465c/64 scope global dynamic noprefixroute 
   valid_lft 189380sec preferred_lft 102980sec
inet6 fe80::cbc3:d989:ae00:fc7c/64 scope <span class="token function">link</span> noprefixroute 
   valid_lft forever preferred_lft forever

➜  Scripts <span class="token function">ip</span> a s eth0 <span class="token operator">|</span> <span class="token function">sed</span> -n <span class="token string">'3p'</span> <span class="token operator">|</span> <span class="token function">sed</span> -r <span class="token string">'s#(^.*inet )(.*)(/24 .*)#\2#'</span>
<span class="token number">122.138</span>.3.43
<span class="token comment"># 精简</span>
➜  Scripts <span class="token function">ip</span> a s eth0 <span class="token operator">|</span> <span class="token function">sed</span> -rn <span class="token string">'3s#(^.*inet )(.*)(/24 .*)#\2#gp'</span>
<span class="token number">122.138</span>.3.43<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="/images/shell/regular_jet.png" alt="结果"></p>
<p><a target="_blank" rel="noopener" href="https://jex.im/regulex/">jex.im/regulex</a></p>
</li>
<li><p>获取文件权限</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">➜  Scripts <span class="token function">stat</span> /etc/hosts                                                     
  File: /etc/hosts
  Size: <span class="token number">230</span>             Blocks: <span class="token number">8</span>          IO Block: <span class="token number">4096</span>   regular <span class="token function">file</span>
Device: b302h/45826d    Inode: <span class="token number">475</span>         Links: <span class="token number">1</span>
Access: <span class="token punctuation">(</span>0644/-rw-r--r--<span class="token punctuation">)</span>  Uid: <span class="token punctuation">(</span>    <span class="token number">0</span>/    root<span class="token punctuation">)</span>   Gid: <span class="token punctuation">(</span>    <span class="token number">0</span>/    root<span class="token punctuation">)</span>
Access: <span class="token number">2020</span>-10-29 <span class="token number">10</span>:04:22.858250738 +0800
Modify: <span class="token number">2020</span>-04-02 01:26:24.731999903 +0800
Change: <span class="token number">2020</span>-04-02 01:26:24.731999903 +0800
 Birth: -

➜  Scripts <span class="token function">stat</span> /etc/hosts <span class="token operator">|</span> <span class="token function">sed</span> -n <span class="token string">'4p'</span> <span class="token operator">|</span> <span class="token function">sed</span> -r <span class="token string">'s#^.*\(0(.*)/-r.*$#\1#g'</span>
<span class="token number">644</span>

➜  Scripts <span class="token function">stat</span> /etc/hosts <span class="token operator">|</span> <span class="token function">sed</span> -n <span class="token string">'4p'</span> <span class="token operator">|</span> <span class="token function">sed</span> -r <span class="token string">'s#^.*\(0(.*)\)  Uid.*$#\1#g'</span> 
<span class="token number">644</span>/-rw-r--r--

➜  Scripts <span class="token function">stat</span> -c%a /etc/hosts 
<span class="token number">644</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
</ul>
</li>
</ul>
<h2 id="三剑客-awk"><a href="#三剑客-awk" class="headerlink" title="三剑客-awk"></a>三剑客-awk</h2><p><code>awk</code>是一门语言, 类似于<code>c</code>语言,一般用于过滤、统计、计算、过滤/统计日志,<code>man awk</code>可知<br><code>Gawk  is  the GNU Project&#39;s implementation of the AWK programming language.  It conforms to the definition of the language in the POSIX 1003.1 standard.  This
version in turn is based on the description in The AWK Programming Language, by Aho, Kernighan, and Weinberger.  Gawk provides the additional  features  found
in the current version of Brian Kernighan&#39;s awk and numerous GNU-specific extensions.</code></p>
<h3 id="示例-1"><a href="#示例-1" class="headerlink" title="示例"></a>示例</h3><ul>
<li>格式<br><code>条件&#123;动作&#125;</code></li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">➜  Scripts <span class="token function">awk</span>  <span class="token string">'BEGIN&#123;print "begin of awk"&#125;NR>=2&amp;&amp;NR&lt;=4&#123;print $1&#125;END&#123;print "end of file"&#125;'</span> ./id.txt
begin of <span class="token function">awk</span>
钱
孙
李
end of <span class="token function">file</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>1、<code>BEGIN&#123;&#125;</code> 是<strong>预处理</strong><br>2、<code>END&#123;&#125;</code>   是<strong>后处理</strong><br>3、<code>NR&gt;=2&amp;&amp;NR&lt;=4&#123;print $1&#125;</code> <strong>条件{动作}</strong>, 表示取出[2,4]行中第1列数据<br>4、<code>$0</code>表示整行</p>
</blockquote>
<h3 id="行和列"><a href="#行和列" class="headerlink" title="行和列"></a>行和列</h3><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">名称</th>
<th style="text-align:center"><code>awk</code>中的名称</th>
<th style="text-align:center">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">行</td>
<td style="text-align:center">记录-<code>record</code></td>
<td style="text-align:center">每一行默认通过回车分割</td>
</tr>
<tr>
<td style="text-align:center">列</td>
<td style="text-align:center">字段,域-<code>field</code></td>
<td style="text-align:center">每一列默认通过空格分割</td>
</tr>
</tbody>
</table>
</div>
<ul>
<li><strong>取行</strong></li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">取行</th>
<th style="text-align:center">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><code>NR==1</code></td>
<td style="text-align:center">取出第1行</td>
</tr>
<tr>
<td style="text-align:center"><code>NR&gt;=1&amp;&amp;NR&lt;=5</code></td>
<td style="text-align:center">取出第1-5行</td>
</tr>
<tr>
<td style="text-align:center"><code>/regular/</code></td>
<td style="text-align:center">正则</td>
</tr>
<tr>
<td style="text-align:center"><code>/start_row/,/end_row/</code></td>
<td style="text-align:center">对应的行区间</td>
</tr>
<tr>
<td style="text-align:center"><code>&lt;,&gt;,&lt;=,&gt;=,==,!=</code></td>
<td style="text-align:center">逻辑判断</td>
</tr>
</tbody>
</table>
</div>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">➜  Scripts <span class="token function">awk</span> <span class="token string">'NR==1'</span> ./sed_test.txt                                                               
<span class="token number">10</span>:00 赵 <span class="token number">211324198705244720</span>

➜  Scripts <span class="token function">awk</span> <span class="token string">'NR>=1 &amp;&amp; NR&lt;=4'</span> ./sed_test.txt
<span class="token number">10</span>:00 赵 <span class="token number">211324198705244720</span>
<span class="token number">10</span>:10 钱 <span class="token number">500224197105168312</span>
<span class="token number">10</span>:20 孙 1233211234569sunSS
<span class="token number">10</span>:30 李 liliangcheng

➜  Scripts <span class="token function">awk</span> <span class="token string">'/li/'</span> ./sed_test.txt
<span class="token number">10</span>:30 李 liliangcheng

➜  Scripts <span class="token function">awk</span> <span class="token string">'/10:20/,/10:40/'</span> ./sed_test.txt
<span class="token number">10</span>:20 孙 1233211234569sunSS
<span class="token number">10</span>:30 李 liliangcheng
<span class="token number">10</span>:40 周 zhou21132693130593<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><p><strong>取列</strong><br>通过<code>-F</code>指定分隔符,指定每一列的结束符标记(默认是空格,连续的空格,<code>tab</code>键), <code>$x</code>表示第<code>x</code>列; </p>
<ul>
<li><p>取出<code>ls -lh</code>的结果中的第<code>[1,end)</code>行第5,9列的内容</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">➜  Scripts <span class="token function">ls</span> -lh <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'NR>1&#123;print $5,$9&#125;'</span> <span class="token operator">|</span> <span class="token function">column</span> -t
<span class="token number">40</span>   <span class="token number">0</span>-debug.sh
<span class="token number">131</span>  ascii.txt
<span class="token number">137</span>  bracket.txt
<span class="token number">56</span>   echo_a.txt
<span class="token number">603</span>  grep_help.txt
<span class="token number">10</span>   id_card_list.txt
<span class="token number">177</span>  id.txt
<span class="token number">78</span>   p.py
<span class="token number">72</span>   question_mark.txt
<span class="token number">225</span>  sed_test.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p><code>column -t</code>用作对齐,参考<a href="/2021/08/15/Linux-命令/">column -t</a></p>
</blockquote>
</li>
<li><p>取出<code>ls -lh</code>的结果中的第<code>[1,end)</code>行第1,最后一列的内容</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">➜  Scripts <span class="token function">ls</span> -lh <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'NR>1&#123;print $1,$NF&#125;'</span>            
-rw-rw-r-- <span class="token number">0</span>-debug.sh
-rw-rw-r-- ascii.txt
-rw-rw-r-- bracket.txt
-rw-rw-r-- echo_a.txt
-rw-rw-r-- grep_help.txt
-rw-rw-r-- id_card_list.txt
-rw-rw-r-- id.txt
-rw-rw-r-- p.py
-rw-rw-r-- question_mark.txt
-rw-rw-r-- sed_test.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>指定分隔符</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">➜  Scripts <span class="token function">head</span> -5 /etc/passwd                                   
root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync

➜  Scripts <span class="token function">head</span> -5 /etc/passwd <span class="token operator">|</span> <span class="token function">awk</span> -F: <span class="token string">'&#123;print $1,$NF&#125;'</span> <span class="token operator">|</span> <span class="token function">column</span> -t  
root    /bin/bash
daemon  /usr/sbin/nologin
bin     /usr/sbin/nologin
sys     /usr/sbin/nologin
<span class="token function">sync</span>    /bin/sync<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p><code>-F</code>支持扩展正则, 且默认支持扩展正则表达式</p>
</blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">➜  Scripts <span class="token function">ip</span> a s eth0 <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">"NR==3"</span>                             
    inet <span class="token number">192.168</span>.5.49/24 brd <span class="token number">192.168</span>.5.255 scope global dynamic noprefixroute eth0

➜  Scripts <span class="token function">ip</span> a s eth0 <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">"NR==3"</span> <span class="token operator">|</span> <span class="token function">awk</span> -F<span class="token string">"[ /]+"</span> <span class="token string">'&#123;print $3&#125;'</span>
<span class="token number">192.168</span>.5.49

➜  Scripts <span class="token function">ip</span> a s eth0 <span class="token operator">|</span> <span class="token function">awk</span> -F<span class="token string">"[ /]+"</span> <span class="token string">'NR==3&#123;print $3&#125;'</span>
<span class="token number">192.168</span>.5.49<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>1、第二个<code>awk</code>后的<code>print</code>必须使用<strong>单引号</strong><br>2、因为要指定分隔符为<strong>空格</strong>或则<code>/</code>,且可能需要多个空格,所以<code>-F</code>的参数要指定为<code>&quot;[ /]+&quot;</code><br>3、<code>inet</code>左边有<code>4</code>个空格, 这4个空格的左边对应<code>$1</code>, 所以<code>ip</code>地址对应着<code>$3</code></p>
</blockquote>
</li>
</ul>
</li>
</ul>
<pre><code>- 保留原分隔符输出
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">➜  Scripts <span class="token function">head</span> -5 /etc/passwd <span class="token operator">|</span> <span class="token function">awk</span> -F: <span class="token string">'&#123;print $1,":",$NF&#125;'</span>
root <span class="token builtin class-name">:</span> /bin/bash
daemon <span class="token builtin class-name">:</span> /usr/sbin/nologin
bin <span class="token builtin class-name">:</span> /usr/sbin/nologin
sys <span class="token builtin class-name">:</span> /usr/sbin/nologin
<span class="token function">sync</span> <span class="token builtin class-name">:</span> /bin/sync

➜  Scripts head-5 /etc/passwd <span class="token operator">|</span> <span class="token function">awk</span> -F: -v <span class="token assign-left variable">OFS</span><span class="token operator">=</span>: <span class="token string">'&#123;print $1,$NF&#125;'</span>            
root:/bin/bash
daemon:/usr/sbin/nologin
bin:/usr/sbin/nologin
sys:/usr/sbin/nologin
sync:/bin/sync<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</code></pre><h3 id="内置变量"><a href="#内置变量" class="headerlink" title="内置变量"></a>内置变量</h3><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">内置变量</th>
<th style="text-align:center">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><code>NR</code></td>
<td style="text-align:center"><code>Number of Record</code>记录号, 行号</td>
</tr>
<tr>
<td style="text-align:center"><code>NF</code></td>
<td style="text-align:center"><code>Number of Field</code>每行总共多少列,<code>$NF</code>表示最后一列</td>
</tr>
<tr>
<td style="text-align:center"><code>FS</code></td>
<td style="text-align:center">等同于<code>-F: === -v FS=:</code>,字段分隔符</td>
</tr>
<tr>
<td style="text-align:center"><code>OFS</code></td>
<td style="text-align:center"><code>Output Field separateor</code>输出字段分隔符</td>
</tr>
</tbody>
</table>
</div>
<h3 id="正则与awk"><a href="#正则与awk" class="headerlink" title="正则与awk"></a>正则与<code>awk</code></h3><ul>
<li><code>awk</code>使用正则时,需要使用<code>//</code></li>
<li><code>awk</code>可以精确到某一列是否包含<code>XXX</code><ul>
<li><code>~</code>表示<strong>包含</strong></li>
<li><code>!~</code>表示<strong>不包含</strong></li>
</ul>
</li>
<li>正则和<code>awk</code>正则对比</li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">正则</th>
<th style="text-align:center"><code>awk</code>正则</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><code>^xxx</code>表示以<code>xxx</code>开头的行</td>
<td style="text-align:center"><code>$3~/^xxx/</code>第3列以<code>xxx</code>开头</td>
</tr>
<tr>
<td style="text-align:center"><code>xxx$</code>表示以<code>xxx</code>结尾的行</td>
<td style="text-align:center"><code>$4~/xxx$/</code>第3列以<code>xxx</code>结尾</td>
</tr>
<tr>
<td style="text-align:center"><code>^$</code>表示空行</td>
<td style="text-align:center"><code>$2~/^$/</code>第2列为空</td>
</tr>
</tbody>
</table>
</div>
<ul>
<li><p>第三列以2开头的行</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">➜  Scripts hheawk -F: <span class="token string">'$3~/^2/'</span> /etc/passwd
bin:x:2:2:bin:/bin:/usr/sbin/nologin<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p>第2列为空的行</p>
<pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">1::2
1:2:3<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">➜  Scripts <span class="token function">awk</span> -F: <span class="token string">'$2~/^$/'</span> ./test.ini  
<span class="token number">1</span>::2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p>找到第3列以<code>2</code>开头的行,并打印第1列和第3列</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">➜  Scripts <span class="token function">awk</span> -F: <span class="token string">'NR==3&#123;print $0&#125;'</span> /etc/passwd
bin:x:2:2:bin:/bin:/usr/sbin/nologin
➜  Scripts <span class="token function">awk</span> -F: <span class="token string">'$3~/^2/&#123;print $1 $3&#125;'</span> /etc/passwd
bin2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>找到第3列以<code>2</code>或则<code>3</code>开头的行,并打印第1列和第3列</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">➜  Scripts <span class="token function">awk</span> -F: <span class="token string">'$3~/^[23]/&#123;print $0&#125;'</span> /etc/passwd
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin
➜  Scripts <span class="token function">awk</span> -F: <span class="token string">'$3~/^[23]/&#123;print $1 $3&#125;'</span> /etc/passwd
bin2
sys3
www-data33
backup34
list38
irc39<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
</ul>
<h3 id="awk范围"><a href="#awk范围" class="headerlink" title="awk范围"></a><code>awk</code>范围</h3><ul>
<li>找到指定时间范围内的内容, 并精确定位指定列<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">➜  Scripts <span class="token function">awk</span> <span class="token string">'/10:30/,/10:60/&#123;print $2&#125;'</span> ./sed_test.txt
李
周
吴
郑<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
</ul>
<h3 id="BEGIN和END"><a href="#BEGIN和END" class="headerlink" title="BEGIN和END"></a><code>BEGIN</code>和<code>END</code></h3><ul>
<li><code>BEGIN</code>和<code>END</code>的运用场景</li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th>模式</th>
<th>说明</th>
<th>运用场景</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>BEGIN&#123;&#125;</code></td>
<td>里面的内容会在<code>awk</code>读取文件之前执行</td>
<td>进行简单统计,计算,通常不涉及读取文件;用来处理文件前,添加表头;用来定位<code>awk</code>变量(很少用,因为可以使用<code>-v</code>);</td>
</tr>
<tr>
<td><code>END&#123;&#125;</code></td>
<td>里面的内容会在<code>awk</code>读取文件之后执行</td>
<td><code>awk</code>进行统计,一般过程：先进行计算,最后<code>END</code>里面输出结果；<code>awk</code>使用数组,在<code>END</code>中输出结果</td>
</tr>
</tbody>
</table>
</div>
<ul>
<li><code>END&#123;&#125;</code>统计计算</li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th>统计方法</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>i++</code></td>
<td>计数</td>
</tr>
<tr>
<td><code>sum = sum + x</code></td>
<td>累加</td>
</tr>
</tbody>
</table>
</div>
<blockquote>
<p><code>i</code>和<code>sum</code>都是变量</p>
</blockquote>
<ul>
<li><p><strong>示例</strong></p>
<ul>
<li><p><strong>统计空行的数量</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">➜  Scripts <span class="token function">awk</span> <span class="token string">'/^$/'</span> /etc/services 






➜  Scripts <span class="token function">awk</span> <span class="token string">'/^$/&#123;i++&#125;END&#123;print i&#125;'</span> /etc/services
<span class="token number">6</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p><strong>求和</strong><br><code>test.csv</code></p>
<pre class="line-numbers language-csv" data-language="csv"><code class="language-csv"><span class="token value">1</span><span class="token punctuation">,</span><span class="token value">2</span><span class="token punctuation">,</span><span class="token value">3</span><span class="token punctuation">,</span><span class="token value">4</span><span class="token punctuation">,</span><span class="token value">5</span>
<span class="token value">2</span><span class="token punctuation">,</span><span class="token value">3</span><span class="token punctuation">,</span><span class="token value">4</span><span class="token punctuation">,</span><span class="token value">5</span><span class="token punctuation">,</span><span class="token value">6</span>
<span class="token value">3</span><span class="token punctuation">,</span><span class="token value">4</span><span class="token punctuation">,</span><span class="token value">5</span><span class="token punctuation">,</span><span class="token value">6</span><span class="token punctuation">,</span><span class="token value">7</span>
<span class="token value">4</span><span class="token punctuation">,</span><span class="token value">5</span><span class="token punctuation">,</span><span class="token value">6</span><span class="token punctuation">,</span><span class="token value">7</span><span class="token punctuation">,</span><span class="token value">8</span>
<span class="token value">5</span><span class="token punctuation">,</span><span class="token value">6</span><span class="token punctuation">,</span><span class="token value">7</span><span class="token punctuation">,</span><span class="token value">8</span><span class="token punctuation">,</span><span class="token value">9</span>
<span class="token value">6</span><span class="token punctuation">,</span><span class="token value">7</span><span class="token punctuation">,</span><span class="token value">8</span><span class="token punctuation">,</span><span class="token value">9</span><span class="token punctuation">,</span><span class="token value">10</span>
<span class="token value">7</span><span class="token punctuation">,</span><span class="token value">8</span><span class="token punctuation">,</span><span class="token value">9</span><span class="token punctuation">,</span><span class="token value">10</span><span class="token punctuation">,</span><span class="token value">11</span>
<span class="token value">8</span><span class="token punctuation">,</span><span class="token value">9</span><span class="token punctuation">,</span><span class="token value">10</span><span class="token punctuation">,</span><span class="token value">11</span><span class="token punctuation">,</span><span class="token value">12</span>
<span class="token value">9</span><span class="token punctuation">,</span><span class="token value">10</span><span class="token punctuation">,</span><span class="token value">11</span><span class="token punctuation">,</span><span class="token value">12</span><span class="token punctuation">,</span><span class="token value">13</span>
<span class="token value">10</span><span class="token punctuation">,</span><span class="token value">11</span><span class="token punctuation">,</span><span class="token value">12</span><span class="token punctuation">,</span><span class="token value">13</span><span class="token punctuation">,</span><span class="token value">14</span>
<span class="token value">11</span><span class="token punctuation">,</span><span class="token value">12</span><span class="token punctuation">,</span><span class="token value">13</span><span class="token punctuation">,</span><span class="token value">14</span><span class="token punctuation">,</span><span class="token value">15</span>
<span class="token value">12</span><span class="token punctuation">,</span><span class="token value">13</span><span class="token punctuation">,</span><span class="token value">14</span><span class="token punctuation">,</span><span class="token value">15</span><span class="token punctuation">,</span><span class="token value">16</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">➜  Scripts <span class="token function">awk</span> -F, <span class="token string">'&#123;sum = sum + $2&#125;END&#123;print sum&#125;'</span> ./test.csv
<span class="token number">90</span>
➜  Scripts <span class="token function">awk</span> -F, <span class="token string">'&#123;sum = sum + $2;print sum&#125;END&#123;print sum&#125;'</span> ./test.csv 
<span class="token number">2</span>
<span class="token number">5</span>
<span class="token number">9</span>
<span class="token number">14</span>
<span class="token number">20</span>
<span class="token number">27</span>
<span class="token number">35</span>
<span class="token number">44</span>
<span class="token number">54</span>
<span class="token number">65</span>
<span class="token number">77</span>
<span class="token number">90</span>
<span class="token number">90</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>在<code>$2</code>后面添加<code>输出</code>,即可显示过程</p>
</blockquote>
</li>
</ul>
</li>
</ul>
<h3 id="awk数组"><a href="#awk数组" class="headerlink" title="awk数组"></a><code>awk</code>数组</h3><p><code>awk</code>数组被用于统计日志, 统计<code>ip</code>出现次数,统计状态码出现次数,统计系统中每个用户被攻击的次数;累加统计每个<code>ip</code>消耗的流量</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center"></th>
<th><strong>shell</strong>数组</th>
<th><strong>awk</strong>数组</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">形式</td>
<td><code>array[0]=value</code></td>
<td><code>array[0]=value</code></td>
</tr>
<tr>
<td style="text-align:center">使用</td>
<td><code>echo $&#123;array[0]&#125;</code></td>
<td><code>print array[0]</code></td>
</tr>
<tr>
<td style="text-align:center">批量输出数组的内容</td>
<td><code>for i in $&#123;array[*]&#125;</code><br><code>do</code><br><code>----echo $i</code><br><code>done</code></td>
<td><code>for(i in array)</code><br><code>----print i</code></td>
</tr>
</tbody>
</table>
</div>
<blockquote>
<p>其中<code>i</code>是索引</p>
</blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">➜  Scripts <span class="token function">awk</span> <span class="token string">'BEGIN&#123;arr[0]="str1";arr[1]="str2"; for(i in arr) print i&#125;'</span> 
<span class="token number">0</span>
<span class="token number">1</span>
➜  Scripts <span class="token function">awk</span> <span class="token string">'BEGIN&#123;arr[0]="str1";arr[1]="str2"; for(i in arr) print arr[i]&#125;'</span>
str1
str2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">➜  Scripts <span class="token function">awk</span> <span class="token string">'BEGIN&#123;arr[0]=str1;arr[1]=str2;print arr[0],arr[1]&#125;'</span>    
 <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<blockquote>
<p>字符串<code>str1</code>和<code>str2</code>都被认为是<strong>变量</strong>, 导致打印是都是<strong>空</strong>,如果使用字符串,参考如下:</p>
</blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">➜  Scripts <span class="token function">awk</span> <span class="token string">'BEGIN&#123;arr[0]="str1";arr[1]="str2";print arr[0],arr[1]&#125;'</span>
str1 str2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h3 id="awk数组经典案例"><a href="#awk数组经典案例" class="headerlink" title="awk数组经典案例"></a><code>awk</code><strong>数组经典案例</strong></h3><p>从以下网址中获取<strong>域名</strong>并<strong>统计访问次数</strong></p>
<ul>
<li><strong>素材</strong><code>url.txt</code><pre class="line-numbers language-html" data-language="html"><code class="language-html">https://github.com/
http://www.open3d.org/docs/release/index.html
https://leetcode-cn.com/
https://github.com/
https://realpython.com/beginners-guide-python-turtle
https://python3-cookbook.readthedocs.io/zh_CN/latest/
https://github.com/
https://leetcode-cn.com/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p><strong>解答</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">➜  Scripts <span class="token function">awk</span> -F/ <span class="token string">'&#123;array[$3]++&#125;END&#123;for(i in array)print i,array[i]&#125;'</span> ./url.txt <span class="token operator">|</span> <span class="token function">column</span> -t
python3-cookbook.readthedocs.io  <span class="token number">1</span>
github.com                       <span class="token number">3</span>
realpython.com                   <span class="token number">1</span>
www.open3d.org                   <span class="token number">1</span>
leetcode-cn.com                  <span class="token number">2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>该案例中索引不是<strong>整数</strong>,而是<strong>字符串</strong>,类似于<code>key-value</code>; 其中<code>i</code>对应<code>key</code>,即为域名, <code>array[i]</code>对应<code>value</code>,即为<strong>访问次数</strong></p>
</blockquote>
</li>
<li><p><strong>输出结果排序</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">➜  Scripts <span class="token function">awk</span> -F/ <span class="token string">'&#123;array[$3]++&#125;END&#123;for(i in array)print i,array[i]&#125;'</span> ./url.txt <span class="token operator">|</span> <span class="token function">column</span> -t <span class="token operator">|</span> <span class="token function">sort</span> -rnk2
github.com                       <span class="token number">3</span>
leetcode-cn.com                  <span class="token number">2</span>
www.open3d.org                   <span class="token number">1</span>
realpython.com                   <span class="token number">1</span>
python3-cookbook.readthedocs.io  <span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p><code>sort</code>用于排序; 参考<a href="/2021/08/15/Linux-命令/">sort参数说明</a></p>
</blockquote>
</li>
</ul>
<h3 id="awk循环与判断"><a href="#awk循环与判断" class="headerlink" title="awk循环与判断"></a><code>awk</code><strong>循环与判断</strong></h3><ul>
<li><code>awk</code><strong>循环</strong></li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th><code>shell for</code>循环</th>
<th><code>awk for</code>循环</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>for(i=1;i&lt;=10;i++)</code><br><code>do</code><br><code>----echo $i</code><br><code>done</code></td>
<td><code>for(i=1;i&lt;=10;i++)</code><br><code>&#123;</code><br><code>----print i</code><br><code>&#125;</code></td>
</tr>
</tbody>
</table>
</div>
<ul>
<li><p><code>awk</code><strong>求和</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">➜  Scripts <span class="token function">awk</span> <span class="token string">'BEGIN&#123;for(i=1;i&lt;=10;i++)sum+=i;print sum&#125;'</span>
<span class="token number">55</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p><code>if</code><strong>条件</strong></p>
</li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th></th>
<th><code>shell if</code>判断</th>
<th><code>awk if</code>判断</th>
</tr>
</thead>
<tbody>
<tr>
<td>单分支</td>
<td><code>if[ &quot;arg&quot; -eq &quot;push&quot; ]</code><br><code>----echo &quot;PUSH&quot;</code><br><code>fi</code></td>
<td><code>if(conditon)</code><br><code>----print &quot;PUSH&quot;</code></td>
</tr>
<tr>
<td>双分支</td>
<td><code>if[ &quot;arg&quot; -eq &quot;push&quot; ]</code><br><code>----echo &quot;PUSH&quot;</code><br><code>else</code><br><code>----echo &quot;POP&quot;</code><br><code>fi</code></td>
<td><code>if(conditon)</code><br><code>----print &quot;PUSH&quot;</code><br><code>else</code><br><code>----print &quot;POP&quot;</code></td>
</tr>
</tbody>
</table>
</div>
<ul>
<li><p>当磁盘<strong>使用率</strong>小于<code>50%</code>时,打印<code>disk is enough</code></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">➜  Scripts <span class="token function">df</span> -h                                                                         
Filesystem      Size  Used Avail Use% Mounted on
udev            <span class="token number">3</span>.7G     <span class="token number">0</span>  <span class="token number">3</span>.7G   <span class="token number">0</span>% /dev
tmpfs           776M  <span class="token number">7</span>.7M  769M   <span class="token number">1</span>% /run
/dev/mmcblk0p2  118G   23G   95G  <span class="token number">20</span>% /
tmpfs           <span class="token number">3</span>.8G     <span class="token number">0</span>  <span class="token number">3</span>.8G   <span class="token number">0</span>% /dev/shm
tmpfs           <span class="token number">5</span>.0M     <span class="token number">0</span>  <span class="token number">5</span>.0M   <span class="token number">0</span>% /run/lock
tmpfs           <span class="token number">3</span>.8G     <span class="token number">0</span>  <span class="token number">3</span>.8G   <span class="token number">0</span>% /sys/fs/cgroup
/dev/loop0       49M   49M     <span class="token number">0</span> <span class="token number">100</span>% /snap/core18/2127
/dev/loop1       49M   49M     <span class="token number">0</span> <span class="token number">100</span>% /snap/core18/2248
/dev/loop2       29M   29M     <span class="token number">0</span> <span class="token number">100</span>% /snap/snapd/13643
/dev/loop5      128K  128K     <span class="token number">0</span> <span class="token number">100</span>% /snap/ubuntu-mate-pi/11
/dev/loop3      128K  128K     <span class="token number">0</span> <span class="token number">100</span>% /snap/software-boutique/56
/dev/loop6       16M   16M     <span class="token number">0</span> <span class="token number">100</span>% /snap/ubuntu-mate-welcome/641
/dev/loop4       29M   29M     <span class="token number">0</span> <span class="token number">100</span>% /snap/snapd/13171
/dev/loop7       16M   16M     <span class="token number">0</span> <span class="token number">100</span>% /snap/ubuntu-mate-welcome/648
/dev/mmcblk0p1  255M  119M  137M  <span class="token number">47</span>% /boot/firmware
tmpfs           776M  <span class="token number">4</span>.0K  776M   <span class="token number">1</span>% /run/user/1000

➜  Scripts <span class="token function">df</span> -h <span class="token operator">|</span> <span class="token function">awk</span> -F<span class="token string">"[ %]+"</span> <span class="token string">'NR>=2&#123;if($5&lt;50)print $6,"disk enough[",$5,"%]"&#125;'</span> <span class="token operator">|</span> <span class="token function">column</span> -t
/dev            disk  enough<span class="token punctuation">[</span>  <span class="token number">0</span>   %<span class="token punctuation">]</span>
/run            disk  enough<span class="token punctuation">[</span>  <span class="token number">1</span>   %<span class="token punctuation">]</span>
/               disk  enough<span class="token punctuation">[</span>  <span class="token number">20</span>  %<span class="token punctuation">]</span>
/dev/shm        disk  enough<span class="token punctuation">[</span>  <span class="token number">0</span>   %<span class="token punctuation">]</span>
/run/lock       disk  enough<span class="token punctuation">[</span>  <span class="token number">0</span>   %<span class="token punctuation">]</span>
/sys/fs/cgroup  disk  enough<span class="token punctuation">[</span>  <span class="token number">0</span>   %<span class="token punctuation">]</span>
/boot/firmware  disk  enough<span class="token punctuation">[</span>  <span class="token number">47</span>  %<span class="token punctuation">]</span>
/run/user/1000  disk  enough<span class="token punctuation">[</span>  <span class="token number">1</span>   %<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>统计语句中单词长度小于<code>6</code>的单词,并显示该单词</p>
<ul>
<li><strong>素材</strong><code>Avatar.txt</code><pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">If you wish to survive you need to cultivate a strong mental attitude.<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
<li><strong>答案</strong><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">➜  Scripts <span class="token function">awk</span> -F<span class="token string">"[ .,]"</span> <span class="token string">'&#123;for(i=1;i&lt;NF;i++)if(length($i)&lt;6)print $i&#125;'</span> ./Avatar.txt
If
you
wish
to
you
need
to
a
<span class="token number">12345</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p><code>length($i)</code>用于求取字符长度;<code>length()</code>用于表示整行字符长度</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">➜  Scripts <span class="token builtin class-name">echo</span> <span class="token number">12345</span> <span class="token number">67890</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'&#123;print length()&#125;'</span>
<span class="token number">11</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></blockquote>
</li>
</ul>
</li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">唐成</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2021/11/21/shell%E7%BC%96%E7%A8%8B/">http://example.com/2021/11/21/shell%E7%BC%96%E7%A8%8B/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">唐成</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Linux/">Linux</a></div><div class="post_share"><div class="social-share" data-image="/images/linux.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2021/11/22/Linux-%E5%86%85%E6%A0%B8%E5%AD%A6%E4%B9%A0-06/"><img class="prev-cover" src="/images/linux_kernel.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Linux-内核学习-06</div></div></a></div><div class="next-post pull-right"><a href="/2021/10/31/Linux-%E5%86%85%E6%A0%B8%E5%AD%A6%E4%B9%A0-08/"><img class="next-cover" src="/images/linux_kernel.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Linux-内核学习-08</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2021/09/02/Linux常用工具安装/" title="Linux常用工具安装"><img class="cover" src="/images/tools.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-09-02</div><div class="title">Linux常用工具安装</div></div></a></div><div><a href="/2021/08/27/Windows上将linux目录映射网络驱动器/" title="Windows上将linux目录映射网络驱动器"><img class="cover" src="/images/mountain.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-08-27</div><div class="title">Windows上将linux目录映射网络驱动器</div></div></a></div><div><a href="/2021/08/15/Linux-命令/" title="Linux 命令"><img class="cover" src="/images/linux.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-08-15</div><div class="title">Linux 命令</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="lv-container" data-id="city"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">唐成</div><div class="author-info__description">一个记录学习的地方</div></div><div class="card-info-data is-center"><div class="card-info-data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">68</div></a></div><div class="card-info-data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">26</div></a></div><div class="card-info-data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">18</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/tangshp"><i class="fab fa-github"></i><span>Don't Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/tangshp" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:791276448@qq.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">暂时没有广告</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#debug"><span class="toc-number">1.</span> <span class="toc-text">debug</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%AD%A3%E5%88%99"><span class="toc-number">2.</span> <span class="toc-text">正则</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%AD%A3%E5%88%99%E7%AC%A6%E5%8F%B7"><span class="toc-number">2.1.</span> <span class="toc-text">正则符号</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%AD%A3%E5%88%99VS%E9%80%9A%E9%85%8D%E7%AC%A6"><span class="toc-number">2.2.</span> <span class="toc-text">正则VS通配符</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E6%AD%A3%E5%88%99"><span class="toc-number">2.3.</span> <span class="toc-text">基础正则</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%A9%E5%B1%95%E6%AD%A3%E5%88%99"><span class="toc-number">2.4.</span> <span class="toc-text">扩展正则</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B"><span class="toc-number">2.5.</span> <span class="toc-text">示例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B2%97%E7%95%A5%E5%9C%B0%E5%8C%B9%E9%85%8D%E8%BA%AB%E4%BB%BD%E8%AF%81"><span class="toc-number">2.5.1.</span> <span class="toc-text">粗略地匹配身份证</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%92%E9%99%A4%E7%A9%BA%E8%A1%8C%E5%92%8C%E5%8C%85%E5%90%AB-%E7%9A%84%E8%A1%8C"><span class="toc-number">2.5.2.</span> <span class="toc-text">排除空行和包含^的行</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%89%E5%89%91%E5%AE%A2"><span class="toc-number">3.</span> <span class="toc-text">三剑客</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E5%89%91%E5%AE%A2-grep"><span class="toc-number">3.1.</span> <span class="toc-text">三剑客-grep</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E5%89%91%E5%AE%A2-sed"><span class="toc-number">3.2.</span> <span class="toc-text">三剑客-sed</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#sed%E6%A0%BC%E5%BC%8F"><span class="toc-number">3.2.1.</span> <span class="toc-text">sed格式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sed%E6%9F%A5%E6%89%BE"><span class="toc-number">3.2.2.</span> <span class="toc-text">sed查找</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4-delete"><span class="toc-number">3.2.3.</span> <span class="toc-text">删除-delete</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sed-%E5%A2%9E%E5%8A%A0cai"><span class="toc-number">3.2.4.</span> <span class="toc-text">sed-增加cai</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sed-%E6%9B%BF%E6%8D%A2s"><span class="toc-number">3.2.5.</span> <span class="toc-text">sed-替换s</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E5%89%91%E5%AE%A2-awk"><span class="toc-number">3.3.</span> <span class="toc-text">三剑客-awk</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B-1"><span class="toc-number">3.3.1.</span> <span class="toc-text">示例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%8C%E5%92%8C%E5%88%97"><span class="toc-number">3.3.2.</span> <span class="toc-text">行和列</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%85%E7%BD%AE%E5%8F%98%E9%87%8F"><span class="toc-number">3.3.3.</span> <span class="toc-text">内置变量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A3%E5%88%99%E4%B8%8Eawk"><span class="toc-number">3.3.4.</span> <span class="toc-text">正则与awk</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#awk%E8%8C%83%E5%9B%B4"><span class="toc-number">3.3.5.</span> <span class="toc-text">awk范围</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#BEGIN%E5%92%8CEND"><span class="toc-number">3.3.6.</span> <span class="toc-text">BEGIN和END</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#awk%E6%95%B0%E7%BB%84"><span class="toc-number">3.3.7.</span> <span class="toc-text">awk数组</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#awk%E6%95%B0%E7%BB%84%E7%BB%8F%E5%85%B8%E6%A1%88%E4%BE%8B"><span class="toc-number">3.3.8.</span> <span class="toc-text">awk数组经典案例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#awk%E5%BE%AA%E7%8E%AF%E4%B8%8E%E5%88%A4%E6%96%AD"><span class="toc-number">3.3.9.</span> <span class="toc-text">awk循环与判断</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2023/02/05/Embedded-System-00/STM32-F103ZET6-14-%E5%90%AF%E5%8A%A8%E6%96%B9%E5%BC%8F/" title="STM32-F103ZET6-14-启动方式&amp;下载"><img src="/images/STM32.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="STM32-F103ZET6-14-启动方式&amp;下载"/></a><div class="content"><a class="title" href="/2023/02/05/Embedded-System-00/STM32-F103ZET6-14-%E5%90%AF%E5%8A%A8%E6%96%B9%E5%BC%8F/" title="STM32-F103ZET6-14-启动方式&amp;下载">STM32-F103ZET6-14-启动方式&amp;下载</a><time datetime="2023-02-05T04:00:07.000Z" title="发表于 2023-02-05 12:00:07">2023-02-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/11/27/OperatingSystem/gdb/" title="gdb"><img src="/images/gdb/cover_gdb.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="gdb"/></a><div class="content"><a class="title" href="/2022/11/27/OperatingSystem/gdb/" title="gdb">gdb</a><time datetime="2022-11-27T12:54:49.000Z" title="发表于 2022-11-27 20:54:49">2022-11-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/11/11/java/02-java%E5%9F%BA%E7%A1%80/" title="02-java基础"><img src="/images/java/java_cover.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="02-java基础"/></a><div class="content"><a class="title" href="/2022/11/11/java/02-java%E5%9F%BA%E7%A1%80/" title="02-java基础">02-java基础</a><time datetime="2022-11-11T14:05:46.000Z" title="发表于 2022-11-11 22:05:46">2022-11-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/11/10/java/01-java%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/" title="01-java环境搭建"><img src="/images/java/java_cover.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="01-java环境搭建"/></a><div class="content"><a class="title" href="/2022/11/10/java/01-java%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/" title="01-java环境搭建">01-java环境搭建</a><time datetime="2022-11-10T14:42:36.000Z" title="发表于 2022-11-10 22:42:36">2022-11-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/09/04/Computer_network/02-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%89%A9%E7%90%86%E5%B1%82/" title="02-计算机网络-物理层"><img src="/images/Compute_network/cover.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="02-计算机网络-物理层"/></a><div class="content"><a class="title" href="/2022/09/04/Computer_network/02-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%89%A9%E7%90%86%E5%B1%82/" title="02-计算机网络-物理层">02-计算机网络-物理层</a><time datetime="2022-09-04T01:29:35.000Z" title="发表于 2022-09-04 09:29:35">2022-09-04</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By 唐成</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">簡</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [ ['$','$'], ["\\(","\\)"]],
      tags: 'ams'
    },
    chtml: {
      scale: 1.2
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, ''],
        insertScript: [200, () => {
          document.querySelectorAll('mjx-container:not\([display]\)').forEach(node => {
            const target = node.parentNode
            if (target.nodeName.toLowerCase() === 'li') {
              target.parentNode.classList.add('has-jax')
            } else {
              target.classList.add('has-jax')
            }
          });
        }, '', false]
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typeset()
}</script><script>if (document.getElementsByClassName('mermaid').length) {
  if (window.mermaidJsLoad) mermaid.init()
  else {
    getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(() => {
      window.mermaidJsLoad = true
      mermaid.initialize({
        theme: 'default',
      })
      true && mermaid.init()
    })
  }
}</script><script>function loadLivere () {
  if (typeof LivereTower === 'object') {
    window.LivereTower.init()
  }
  else {
    (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
    })(document, 'script');
  }
}

if ('Livere' === 'Livere' || !false) {
  if (false) btf.loadComment(document.getElementById('lv-container'), loadLivere)
  else loadLivere()
}
else {
  function loadOtherComment () {
    loadLivere()
  }
}</script></div><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = [
  'title',
  '#config-diff',
  '#body-wrap',
  '#rightside-config-hide',
  '#rightside-config-show',
  '.js-pjax'
]

if (true) {
  pjaxSelectors.unshift('meta[property="og:image"]', 'meta[property="og:title"]', 'meta[property="og:url"]')
}

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.removeEventListener('scroll', window.tocScrollFn)
  window.removeEventListener('scroll', scrollCollect)

  typeof preloader === 'object' && preloader.initLoading()
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // Analytics
  if (false) {
    MtaH5.pgv()
  }

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()

  typeof preloader === 'object' && preloader.endLoading()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>